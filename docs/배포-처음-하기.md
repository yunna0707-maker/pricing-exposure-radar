# 배포 처음 하기 — 한 번에 따라하기 가이드

이 문서는 **배포를 한 번도 해본 적 없는 분**이, Cursor 터미널 복붙 + Vercel 웹 클릭만으로 끝까지 배포할 수 있도록 작성했습니다.

---

## 준비 점검 (에이전트가 이미 처리함)

- [x] 레포 루트에 `vercel.json` 있음 (서브폴더 Next 앱 인식용)
- [x] 레포 루트에 `public/.gitkeep` 있음 ("No Output Directory named public" 방지)
- [x] `.gitignore`에 `.env.local` 포함 (비밀키 절대 커밋 안 됨)
- [x] `fare-exposure-anchor/package.json`에 `"build": "npx next build"` 있음

---

# (A) 터미널에 복붙할 명령어 세트

**Cursor에서 터미널을 열고**, 프로젝트 루트(`pricing-exposure-radar`)로 이동한 뒤, 아래를 **한 줄씩 순서대로** 복사해서 붙여넣고 Enter 치세요.

```powershell
cd c:\Users\TS1588\Desktop\pricing-exposure-radar
```

```powershell
git status
```
→ 변경된 파일 목록이 나오면 OK. 다음으로 진행.

```powershell
git add .
```

```powershell
git commit -m "prepare vercel deploy"
```

```powershell
git branch -M main
```

```powershell
git remote -v
```
→ `origin` 이 `https://github.com/yunna0707-maker/pricing-exposure-radar.git` 로 나오면 **이미 연결된 것**이므로 다음 단계로.

→ `origin` 이 안 나오면 아래 한 번만 실행:
```powershell
git remote add origin https://github.com/yunna0707-maker/pricing-exposure-radar.git
```

```powershell
git push -u origin main
```

---

### Push 할 때 인증 오류가 나면

**증상 예시:**
- `fatal: unable to access '...': schannel: AcquireCredentialsHandle failed (SEC_E_NO_CREDENTIALS)`
- `Authentication failed` / `Permission denied` / `Support for password authentication was removed`

**해결 순서:**

1. **GitHub에 로그인되어 있는지 확인**  
   브라우저에서 https://github.com 로그인한 뒤, 터미널에서 다시 `git push -u origin main` 실행.

2. **Personal Access Token 사용 (HTTPS인 경우)**  
   - GitHub → 우측 상단 프로필 클릭 → **Settings**  
   - 왼쪽 맨 아래 **Developer settings** → **Personal access tokens** → **Tokens (classic)**  
   - **Generate new token (classic)**  
   - Note: `vercel-deploy` 등 아무 이름  
   - Expiration: 90 days 또는 원하는 기간  
   - Scope: **repo** 체크  
   - **Generate token** 클릭 → 나온 토큰을 **한 번만** 복사해 두기 (다시 안 보임)  
   - 터미널에서 다시 `git push -u origin main`  
   - Username: GitHub 아이디  
   - Password: **비밀번호 대신 방금 복사한 토큰** 붙여넣기  

3. **Git Credential Manager 사용 (Windows)**  
   푸시할 때 브라우저가 뜨면 GitHub 로그인하면 됨.

4. **SSH로 바꾸고 싶다면**  
   - GitHub 저장소 페이지에서 **Code** → **SSH** 선택 후 URL 복사  
   - 터미널: `git remote set-url origin git@github.com:yunna0707-maker/pricing-exposure-radar.git`  
   - SSH 키가 이미 있으면 그 다음부터 `git push -u origin main` 만 하면 됨.

---

# (B) Vercel 웹에서 클릭/설정 순서 (체크리스트)

아래를 **순서대로** 체크하면서 진행하세요.

## 1) Vercel 들어가기
- [ ] 브라우저에서 https://vercel.com 접속
- [ ] **Log in** (또는 Sign up) → **Continue with GitHub** 선택해서 GitHub로 로그인

## 2) 새 프로젝트 만들기
- [ ] 오른쪽 위 **Add New…** 클릭
- [ ] **Project** 선택

## 3) GitHub 저장소 가져오기
- [ ] GitHub 연결이 안 되어 있으면 **Connect Git Repository** 등으로 GitHub 연결
- [ ] 목록에서 **pricing-exposure-radar** (yunna0707-maker) 찾아서 **Import** 클릭

## 4) 설정 화면에서 반드시 확인할 것

| 항목 | 해야 할 것 | 하지 말 것 |
|------|------------|------------|
| **Framework Preset** | **Next.js** 로 되어 있는지 확인 | 다른 프레임워크 선택 금지 |
| **Root Directory** | 가능하면 `fare-exposure-anchor` 입력 (더 안정적). 비워도 됨(루트에 vercel.json 있음) | 루트 그대로 두고 설정 건드리지 않아도 됨 |
| **Build Command** | 비워두기(자동) **또는** `npm run build --prefix fare-exposure-anchor` | — |
| **Install Command** | 비워두기(자동) **또는** `npm install --prefix fare-exposure-anchor` | — |
| **Output Directory** | **반드시 비움**. AUTOMATIC 그대로 | **절대 `public` 입력하지 말 것** (이전 오류 원인) |

- [ ] Root Directory: `fare-exposure-anchor` 입력 (권장)
- [ ] Output Directory: 비어 있는지 확인 (자동)

## 5) 환경 변수 (매우 중요)
- [ ] **Environment Variables** 섹션 펼치기
- [ ] 아래 두 개 추가 (이름 정확히 똑같이):

| Name | Value | 적용 환경 |
|------|--------|-----------|
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase 대시보드 → Project Settings → API → **Project URL** 복사 | Production, Preview 체크 |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase 대시보드 → Project Settings → API → **service_role** (secret) 복사 | Production, Preview 체크 |

⚠️ **주의**
- **anon key가 아니라 service_role key** 를 넣어야 합니다. (anon 넣으면 권한 오류 납니다.)
- 값은 한 번에 복사해서 붙여넣고, 앞뒤 공백 없게 하세요.

- [ ] 두 변수 모두 입력했는지 확인
- [ ] **Deploy** 버튼 클릭

## 6) 배포 완료 대기
- [ ] 빌드 로그가 나오며 끝까지 진행되는지 확인
- [ ] **Congratulations** / 배포 완료 화면이 나오면 성공
- [ ] **Visit** 또는 배포 URL 클릭해서 열기

---

# (C) 배포 후 테스트할 URL 목록

배포가 끝나면 아래 주소로 접속해 보세요. (실제 도메인은 Vercel이 준 주소로 바꿉니다.)

| 확인할 것 | URL 예시 |
|-----------|-----------|
| 메인 페이지 (리다이렉트) | `https://프로젝트이름.vercel.app/` |
| **대시보드 (가장 중요)** | `https://프로젝트이름.vercel.app/dashboard` |
| API (summary) | `https://프로젝트이름.vercel.app/api/exposures/summary?airline=KE&origin=ICN&dest=NRT&tripType=RT&period=7d` |

- 루트(`/`) 접속 시 `/dashboard` 로 넘어가면 정상.
- `/dashboard` 에서 상단 KPI 카드가 보이면 정상.
- API URL은 브라우저 주소창에 붙여넣었을 때 JSON이 보이거나, 대시보드에서 필터 선택 후 **조회** 했을 때 데이터가 나오면 정상.

**데이터가 안 보일 때:** Supabase에 `exposure_events` 테이블이 있고, 데이터가 있어야 합니다. 없으면 `fare-exposure-anchor` 폴더에서 `npm run seed` 로 시드 데이터 넣을 수 있음 (로컬 DB 기준). 배포 환경은 Supabase 클라우드 DB를 쓰므로, Supabase 대시보드에서 테이블/데이터를 확인하세요.

---

# (D) 흔한 에러 3가지와 해결법

## 1) "No Output Directory named 'public' found after the Build completed."

**원인:** Vercel이 이 프로젝트를 일반 정적 사이트로 인식해 `public` 폴더를 찾음. 우리는 Next.js 앱이 **서브폴더(`fare-exposure-anchor`)** 에 있음.

**해결:**
- **Vercel Project Settings → General → Root Directory** 를 `fare-exposure-anchor` 로 설정한 뒤 **Save** 하고, **Deployments** 에서 **Redeploy**.
- 레포 루트에 `vercel.json`(이미 있음)과 `public/.gitkeep`(이미 있음)이 있으면 같은 오류 재발을 줄이는 데 도움이 됨.
- **Output Directory** 는 **비워 두기**. `public` 이라고 넣지 말 것.

---

## 2) Missing env var / 환경 변수 관련 오류

**증상:** 빌드는 되는데 페이지가 안 뜨거나, "API에 연결할 수 없습니다" 같은 메시지, 또는 Vercel 로그에 env 관련 에러.

**해결:**
- Vercel 대시보드 → 해당 프로젝트 → **Settings** → **Environment Variables**
- `NEXT_PUBLIC_SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` 가 **정확한 이름**으로 들어가 있는지 확인.
- 값은 Supabase **Project Settings → API** 에서:
  - **Project URL** → `NEXT_PUBLIC_SUPABASE_URL`
  - **service_role** (secret) → `SUPABASE_SERVICE_ROLE_KEY`  
  anon key가 아닌 **service_role** 인지 꼭 확인.
- 수정 후 **Deployments** 에서 **Redeploy** 한 번 더 하기.

---

## 3) Supabase permission / RLS 에러 (데이터 안 나옴, 403 등)

**증상:** 대시보드가 뜨지만 KPI/표에 데이터가 안 나오거나, API가 403/500을 반환.

**해결:**
- 이 앱은 **service_role** 로 Supabase에 접속합니다. RLS(Row Level Security)가 켜져 있어도 service_role 은 우회 가능합니다.
- Supabase 대시보드 → **Table Editor** 에서 `exposure_events` 테이블이 있는지 확인.
- 없으면 `fare-exposure-anchor/supabase/schema.sql` 내용을 Supabase SQL Editor에서 실행해 테이블 생성.
- **Database → Roles** 에서 service_role 키가 맞는지, **Project Settings → API** 의 service_role 키와 동일한지 확인.
- 가능하면 RLS 정책이 이 테이블을 막고 있진 않은지 확인. (지금 구조는 service_role 이라 보통 문제 없음.)

---

# 요약 체크리스트

- [ ] (A) 터미널 명령어로 `git add` → `commit` → `push` 까지 완료
- [ ] (B) Vercel에서 Import → Root Directory `fare-exposure-anchor` → Output 비움 → env 2개 설정 → Deploy
- [ ] (C) 배포 URL `/dashboard` 와 API URL 로 동작 확인
- [ ] (D) 오류 나면 위 3가지(Output Directory, env, Supabase) 순서로 점검

이 순서대로만 하면 배포까지 한 번에 진행할 수 있습니다.
