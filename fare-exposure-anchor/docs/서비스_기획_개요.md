# 가격 노출 기준점(Pricing Exposure Anchor) — 서비스 기획 개요

> 개발자가 아닌 기획자·운영자·임원이 이해할 수 있도록, **실제 구현을 기준으로** 정리한 설명 문서입니다.

---

## 1. 서비스 개요 (Why)

### 1.1 만들어진 배경

항공 운임(가격) 전략을 세울 때, **“어떤 가격대를 얼마나 시장에 노출했는지”**를 정량적으로 보지 못하면, 마진·할인 정책을 **감에 의존**하게 됩니다. 이 서비스는 **가격 노출(Exposure) 로그**를 적재·집계하고, 노출 분포와 **기준점(Anchor)**을 시각화해, **데이터 기반 의사결정**을 지원하기 위해 만들어졌습니다.

### 1.2 기존 항공 운임/가격 전략에서의 문제점

- **감에 의존한 마진 설정**: 어떤 가격대가 실제로 많이 노출되는지 모른 채 마진을 정함.
- **가격 노출 분포를 정량적으로 보지 못함**: 특정 노선·기간에서 “어떤 금액이 몇 번 노출되었는지”를 한눈에 보는 도구가 없음.
- **시장 기준 가격 기준점 부재**: “어느 가격대에서 경쟁 중인지”, “어디서 판매 가능성이 높은지”를 수치로 제시하지 못함.

### 1.3 “가격 노출 기준점(Anchor)” 개념을 도입한 이유

- 노출된 가격들의 **중앙값(P50)**을 **Anchor(기준점)**으로 두어, “시장에 노출된 가격의 중심”을 하나의 숫자로 제시합니다.
- 이를 통해 **가격 전략의 기준선**을 두고, P25~P75 구간으로 “경쟁이 치열한 가격대”를 함께 보여, 마진·이익율 설계 시 **참고점**으로 쓸 수 있게 합니다.

### 1.4 이 서비스가 의사결정에 주는 핵심 가치

- **노출 분포 가시화**: 특정 항공사·노선·편도/왕복·기간 조건에서, 어떤 가격대에 노출이 집중되는지 한 화면에서 파악.
- **기준점 도출**: Anchor(중앙값)와 최빈 구간으로 “어디를 전쟁터로 볼지” 정할 수 있음.
- **가격대별 전략 참고**: 노출 비중이 높은 구간에 “마진 실험 우선” 등 우선순위를 부여해, 이익율 전략 수립을 지원.

---

## 2. 서비스 핵심 개념 정리

| 용어 | 정의 |
|------|------|
| **가격 노출(Exposure)** | 사용자(세션)가 검색·조회했을 때 특정 운임(가격)이 결과에 노출된 한 건의 기록. “이 가격이 이 조건에서 한 번 보였다”는 이벤트. |
| **노출 횟수** | 조건에 맞는 exposure 이벤트의 **총 건수**. 같은 가격이 여러 번 노출되면 그만큼 카운트됨. |
| **도달 세션 수(Unique Sessions)** | 노출 이벤트를 **session_id** 기준으로 묶었을 때의 고유 세션 개수. “가격을 본 사람(세션) 수”의 근사치. |
| **방문 수(Pageviews)** | 대시보드 페이지가 **조회된 횟수**. visit_events 테이블에 기록되며, “이 대시보드를 몇 번 열었는지”를 의미. |
| **방문자 수(Unique)** | **pea_vid** 쿠키(365일)로 구분한 고유 방문자 수. “몇 명이 대시보드를 봤는지”의 근사치. |
| **Anchor(기준점)** | 선택 조건 내 노출된 가격들의 **중앙값(P50)**. “노출 가격의 중심”을 나타내는 단일 숫자로, 가격 전략의 기준점으로 사용. |
| **경쟁이 가장 치열한 가격대** | 노출 건수가 **가장 많은 가격 구간(최빈 구간, modeBin)**. 히스토그램에서 막대가 가장 높은 구간이며, 여러 경쟁 가격이 이 구간에 몰려 있다는 해석이 가능. |

---

## 3. 전체 사용자 흐름 (High-level Flow)

1. **대시보드 진입**  
   필터(항공사, 출발, 도착, 편도/왕복, 기간)가 기본값으로 세팅됨. 기간은 기본 “최근 24시간”.

2. **필터 선택**  
   항공사·출발지·도착지·편도/왕복·기간을 선택. 출발/도착 옵션은 **선택한 조건(항공사·편도/왕복·기간 등)에 따라 실제 데이터에 존재하는 값만** 드롭다운에 노출됨(캐스케이딩).

3. **조회 버튼 클릭**  
   - **필수 5개(항공사, 출발, 도착, 편도/왕복, 기간)** 중 하나라도 비어 있으면 API를 호출하지 않고, **토스트**로 “다음 조건을 선택해 주세요. 누락: ○○, ○○”를 표시.
   - 모두 선택된 경우에만 API 호출이 이루어지며, 로딩 중에는 조회·초기화 버튼이 잠시 비활성화되어 중복 요청을 막음.

4. **결과 해석**  
   KPI 카드(노출 횟수, 도달 세션 수, 노출 밀도, Anchor, 핵심 경쟁 가격대), 히스토그램, 가격대별 전략 참고, 동일 금액별 노출 횟수, 시간대별 운임, 최근 노출 로그 등을 보고 전략을 논의.

5. **초기화 버튼 클릭**  
   필터를 기본값으로 되돌리고, 조회 결과·에러·로딩 상태를 모두 지움. 다시 “조건 선택 후 조회” 상태로 돌아감.

### “필수 조건을 모두 선택해야 조회 가능”인 이유

- API는 **항공사·출발·도착·편도/왕복**이 없으면 400 에러를 반환합니다. “전체”나 “미지정”으로 조회하면 데이터가 과도하게 많아지고, **노선·여정이 섞인 집계**가 되어 해석이 어렵기 때문입니다. 기간(period)도 필수로 두어 “언제 기준”인지 항상 명확히 합니다.

### 조회 버튼 / 초기화 버튼의 역할

- **조회**: 클릭 시 필수값 검증 → 누락 시 토스트만 표시, 모두 있으면 API 호출 후 결과 표시.
- **초기화**: 필터를 기본값으로 리셋하고, 표시 중이던 조회 결과·에러·로딩을 모두 제거.

---

## 4. 기능 단위별 상세 설명

### 4.1 필터 영역

| 항목 | 설명 |
|------|------|
| **항공사** | 노출 이벤트의 airline 기준 필터. 옵션 목록은 **기간·편도/왕복·채널·출발/도착 등 현재 조건에서 실제로 존재하는 항공사만** API(/api/exposures/options)에서 가져와 표시. |
| **출발지(Origin) / 도착지(Dest)** | 공항 코드(예: ICN, GMP, CJU) 기준. 옵션은 동일하게 **선택된 다른 필터에 맞는 데이터만** 조회해 노출. 따라서 “선택 조건에 따라 가능한 OD(Origin-Destination)만” 보이게 됨. 선택 후 다른 필터를 바꿨을 때 현재 조합에 해당 노선이 없으면, 출발/도착이 자동으로 비워지고 “현재 조건에서 가능한 노선이 없어 출발/도착 선택을 초기화했습니다” 토스트가 뜸. |
| **편도/왕복** | OW(편도), RT(왕복), MC(다구간) 등. 옵션은 동일 기간·항공사 등 조건 하에 DB에 존재하는 trip_type 값만 표시. |
| **기간** | **최근 24시간(24h)** / **최근 7일(7d)**. API 쿼리 시 `ts`(타임스탬프)가 이 기간 안인 행만 사용. 기본값은 24h. |
| **채널** | 전체 / 웹 / 모바일 / API. 선택 시 해당 channel 값만 필터링. |
| **출발일·도착일** | 옵션. YYYY-MM-DD 형식으로 지정 시 exposure_events의 departure_date, arrival_date로 필터. |

노선 매칭은 **origin·dest 컬럼의 일치**로 이루어지며, “가능한 OD만 노출”되는 이유는 options API가 **나머지 필터를 적용한 뒤** distinct한 origin, dest 목록만 돌려주기 때문입니다.

---

### 4.2 방문자 지표 영역

- **방문 수(Pageviews)**  
  선택한 기간(24h 또는 7d) 동안 **대시보드(path=/dashboard)** 가 조회된 횟수. `visit_events` 테이블에 기록된 건수.

- **방문자 수(Unique)**  
  동일 기간·동일 path에서 **visitor_id** 기준으로 센 고유 방문자 수. visitor_id는 **pea_vid** 쿠키(365일)로 생성·유지되므로 “고유 방문자”의 근사치.

이 지표들은 **대시보드 사용량**을 보는 것이며, “가격 노출” 자체의 건수·세션 수와는 별개입니다. 다만 같은 화면에서 기간을 24h/7d로 맞춰 두면, “이 기간에 대시보드를 얼마나 썼는지”와 “이 기간 노출 데이터”를 함께 해석하는 데 쓸 수 있습니다.

---

### 4.3 핵심 요약 KPI 카드

| 지표 | 의미 | 계산 방식 |
|------|------|-----------|
| **가격 노출 횟수** | 선택 조건에서 가격이 노출된 **총 건수** | exposure_events 조건 필터 후 행 개수 |
| **도달 세션 수** | 가격을 본 **고유 세션 수** | 동일 데이터에서 session_id 기준 unique 개수 |
| **노출 밀도** | 세션당 평균 노출 횟수 | 가격 노출 횟수 ÷ 도달 세션 수 (세션 0이면 0) |
| **Anchor(기준점)** | 노출 가격의 **중앙값** | P50 (정렬된 가격 배열의 50% 위치 값) |
| **핵심 경쟁 가격대** | 노출의 가운데 50%가 모여 있는 구간 | P25 ~ P75. 최빈 구간(modeBin) 비중이 있으면 “전체 노출의 ○○%가 집중” 문구로 표시 |

---

### 4.4 가격 노출 분포 분석 (히스토그램)

- **가격 구간(bucket)**  
  노출된 가격(price_krw)을 **일정 금액 단위(binSize)**로 나눈 구간. 예: 1만 원 단위면 10만~11만, 11만~12만 … 각 구간에 속한 노출 건수를 막대로 표시.

- **구간 크기(1만 원 ~ 5만 원)**  
  사용자가 1만/2만/3만/4만/5만 원 중에서 선택 가능. 구간을 크게 잡으면 막대 수가 줄어 전체 형태를 보기 좋고, 작게 잡으면 특정 금액대가 더 잘 드러남.

- **노출이 집중된 가격대 해석**  
  막대가 높은 구간 = 그 금액대에서 노출이 많이 일어났다는 뜻. **경쟁이 치열한 구간**으로 해석할 수 있으며, 차트에 Anchor(기준점) 세로선이 함께 그려져 “기준점 대비 어디가 전쟁터인지”를 볼 수 있음.

- **일부 구간이 0%로 나오는 이유**  
  해당 조건으로 **실제 노출된 가격이 그 구간에 하나도 없으면** 건수 0이라 0%로 표시됨. 데이터가 없는 구간이지 오류가 아님.

---

### 4.5 가격대별 전략 가이드 영역 (가격대별 이익율 전략 수립 참고)

- **우선순위 산정**  
  - **HIGH**: 노출 비중 **10% 이상**이거나, 비중 순 **상위 2위 이내**인 구간 → “마진 실험 우선”.  
  - **MEDIUM**: 노출 비중 **6% 이상** → “마진 검토 참고”.  
  - **LOW**: 그 외 → “방어 구간”.

- **의미**  
  - “마진 실험 우선”: 해당 가격대에서 노출이 많으므로, 마진을 ±0.5% 등 소폭 조정해 보는 실험을 먼저 해볼 구간.  
  - “방어 구간”: 상대적으로 노출이 적은 구간으로, 전략 우선순위는 낮지만 가격선 유지·방어 시 참고.

- **운영자가 취할 수 있는 액션**  
  - HIGH 구간: 마진/할인율 소폭 변경 후 노출·전환 지표 재조회.  
  - MEDIUM: 주간 단위로 비중 추이를 보며 마진 검토.  
  - 인사이트 카드의 “Recommended Action” 문구(예: “해당 구간 마진 ±0.5% 실험 우선 추천”)를 회의·보고 시 활용.

---

### 4.6 동일 금액별 노출 횟수

- **내용**  
  같은 **정확한 금액(price_krw)**이 조건 내에서 **몇 번 노출되었는지**를 건수 기준으로 집계해, 상위 50개 금액을 랭킹·바·미니 차트로 표시.

- **해석**  
  - 특정 금액이 매우 많이 반복 노출되면, 그 가격대로 **고정하거나 자주 노출하는 경쟁 동작**이 있다는 신호로 볼 수 있음.  
  - “이 금액이 시장에 자주 보인다”는 의미이므로, 경쟁사 가격 고정·집중 노출 전략을 모니터링하는 참고가 됨.

- **행 클릭 시**  
  해당 금액(price_krw)으로 드릴다운 요청을 보내, 시간대별·채널·순위 등 상세 노출 로그를 드로어에서 확인할 수 있음.

---

## 5. 데이터 구조 & 처리 개요

### 5.1 exposure 데이터 기본 구조

**exposure_events** 테이블(핵심 컬럼):

- **ts**: 노출 발생 시각  
- **airline, origin, dest, trip_type, channel**: 노선·채널  
- **session_id, search_id, result_rank**: 세션·검색·순위  
- **price_krw, currency**: 가격(원화)  
- **departure_date, arrival_date**: 출발일·도착일(옵션)  
- **meta**: 기타 메타데이터

한 행 = “한 번의 가격 노출” 이벤트.

### 5.2 필터 → API → 집계 → 시각화 흐름

1. 사용자가 필터(항공사, 출발, 도착, 편도/왕복, 기간 등)를 선택하고 **조회** 클릭.
2. 프론트에서 **필수 5개(항공사, 출발, 도착, 편도/왕복, 기간)** 검증. 누락 시 토스트 후 API 미호출.
3. 통과 시 동일 쿼리 파라미터로 **summary, histogram, timeseries, recent, price-counts** 등 API를 병렬 호출.
4. 각 API는 **동일 필터·기간**으로 exposure_events를 조회한 뒤,  
   - summary: 건수, 세션 수, P25/P50/P75, Anchor(=P50), 최빈 구간  
   - histogram: binSize별 구간 건수  
   - timeseries: 시간대별 평균/중앙값/건수  
   - recent: 최근 30건  
   - price-counts: 동일 금액별 노출 횟수 상위 50개  
   를 계산해 JSON으로 반환.
5. 대시보드는 이 결과를 받아 KPI 카드·차트·테이블로 렌더링.

### 5.3 왜 일부 가격 구간은 0%로 나올 수 있는지

해당 필터·기간 안에서 **그 구간에 속한 가격이 한 건도 없으면** 건수 0 → 비중 0%로 표시됩니다. 데이터 부재를 나타내는 정상 동작입니다.

### 5.4 왜 필터 미선택 시 전체 데이터를 노출하지 않는지

- API는 **airline, origin, dest, tripType**이 비어 있으면 400 에러를 반환합니다.
- “전체”로 조회하면 노선·여정이 섞여 **해석이 어렵고**, 데이터량도 불필요하게 커질 수 있어, “특정 노선·여정·기간”을 반드시 지정하도록 설계되어 있습니다.

---

## 6. 운영 관점 활용 시나리오

- **가격 전략 수립 시**: Anchor·P25~P75·최빈 구간을 보고 “어디를 기준선으로 둘지”, “어느 구간에 마진을 걸지” 논의.
- **마진 조정 실험 전**: HIGH 구간을 찾아 해당 가격대에서 소폭 마진 변경 후, 동일 조건으로 다시 조회해 분포 변화 확인.
- **경쟁사 가격 모니터링**: 동일 금액별 노출 횟수에서 특정 금액이 반복 노출되는지 보고, 고정가·집중 노출 여부 참고.
- **내부 보고(기획/MD/대표)**: KPI 카드·히스토그램·전략 가이드 문구를 캡처하거나 인용해 “노출 기준점·경쟁 구간” 중심으로 요약 보고.

---

## 7. 현재 한계와 의도된 제약

- **노출(Exposure) 데이터 기반**: 실제 **예약(Book)·매출** 데이터가 아님. “보였던 가격”의 분포이므로, 전환·수익과는 별도로 해석해야 함.
- **예측 도구가 아님**: 과거·현재 노출 집계와 기준점 제시에 초점을 두며, “앞으로 가격이 오를지/내릴지”를 예측하는 기능은 없음. **의사결정 참고 도구**로만 사용하는 것이 적절함.
- **일부 데이터는 seed/mock**: 로컬·데모 환경에서는 `npm run seed`로 넣은 시드 데이터(항공사·노선·가격 분포가 스크립트로 생성)를 사용할 수 있음. 운영에서는 실제 노출 수집 파이프라인에서 적재한 데이터를 사용하는 것을 전제로 함.

---

## 8. 향후 확장 아이디어 (코드 기반 현실적인 범위)

- **노선별 Anchor 비교**: 동일 기간에 여러 OD의 Anchor를 한 테이블/차트로 비교.
- **항공사 간 Anchor 차이**: 동일 OD·기간에서 항공사별 Anchor·P25~P75 비교.
- **시간대별 가격 이동**: 현재 timeseries(시간대별 평균/중앙값/건수)를 확장해 “요일·시간대별 Anchor 추이” 등으로 활용.
- **마진 시뮬레이터 연계**: Anchor·구간별 노출 비중을 입력으로 “마진 ±N% 시 예상 구간 이동” 같은 시뮬레이션 UI 연동.
- **실제 Book 데이터 결합**: 예약·매출 데이터가 있다면, “노출 대비 전환율”, “노출 구간별 전환률” 등으로 노출 지표와 결합한 분석으로 확장 가능.

---

## 부록: 한 줄 정의 / 내부 공유용 요약 / 포트폴리오용 문단

### 이 서비스의 한 줄 정의

**“항공 운임이 시장에 노출된 로그를 집계해, 노출 분포와 기준점(Anchor)을 보여 주고, 가격·마진 전략 수립을 지원하는 대시보드 서비스.”**

---

### 내부 공유용 요약 (5줄)

1. 항공 운임 **노출(Exposure)** 로그를 DB에 쌓고, 항공사·노선·편도/왕복·기간으로 필터해 집계·시각화하는 대시보드입니다.  
2. **Anchor(노출 가격 중앙값)**와 P25~P75, 최빈 구간으로 “어디가 경쟁 구간인지”를 한눈에 보여 줍니다.  
3. 가격대별 **노출 비중**에 따라 HIGH/MEDIUM/LOW 우선순위와 “마진 실험 우선” 등 액션 가이드를 제시해, 이익율 전략 수립을 돕습니다.  
4. 동일 금액별 노출 횟수, 시간대별 운임, 최근 노출 로그로 **경쟁 가격·노출 패턴**을 세부적으로 볼 수 있습니다.  
5. **노출 기준**이지 예약/매출 데이터가 아니며, 의사결정 **참고 도구**로 사용하는 것이 적절합니다.

---

### 포트폴리오에 사용할 수 있는 설명 문단 (PM 관점)

항공 운임 가격 전략에서 “어떤 가격대를 얼마나 노출했는지”를 정량적으로 보지 못해 감에 의존하는 문제를 해결하기 위해, **가격 노출 기준점(Pricing Exposure Anchor)** 서비스를 기획·정의했습니다. 사용자는 항공사·노선·편도/왕복·기간을 선택한 뒤 조회하면, **노출 횟수·도달 세션 수·노출 밀도**와 **Anchor(노출 가격 중앙값)**를 KPI로 보고, **가격 구간별 노출 분포(히스토그램)**와 **노출 비중 기반 전략 우선순위(HIGH/MEDIUM/LOW)**를 통해 “어디에 마진 실험을 우선 적용할지”를 판단할 수 있습니다. 동일 금액별 노출 횟수와 시간대별 운임으로 경쟁 가격 패턴을 드릴다운하며, **노출 데이터 기반의 의사결정 참고 도구**로 포지셔닝했습니다. 필수 필터 검증·캐스케이딩 옵션·초기화 정책을 명확히 해, 기획·운영·임원이 함께 쓸 수 있는 문서와 UX를 맞춰 두었습니다.
